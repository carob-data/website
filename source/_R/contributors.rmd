---
title: "&#32;"
output: html_document
editor_options: 
  chunk_output_type: inline
---


```{r setup, include=FALSE}
carob_path = "../../../carob/"

data_path = file.path(carob_path, "data/compiled")
data_path2 = file.path(carob_path, "data")
  
library(kableExtra)
```

```{r groups, echo=FALSE}
ff <- list.files(data_path, pattern=".csv$", full=TRUE)
ff <- ff[!grepl("_terms", ff)]
f <- grep(ff, pattern="_metadata.csv$", value=TRUE)

groups <- gsub("_metadata.csv$", "", basename(f))
groups <- gsub("^carob_", "", groups)

d <- lapply(f, read.csv)

get_tab <- function(d, var) {
	p <- lapply(1:length(d), \(i) {
				n <- d[[i]][[var]]
				n <- unlist(strsplit(n, ";"))
				data.frame(id=i, p=trimws(n))
			}
		)
	p <- do.call(rbind, p)
	tab <- as.data.frame(table(p$p))
	colnames(tab) <- c("name", "datasets")
	tab 
}

	pp <- sapply(1:length(d), \(i) {
				d[[i]][["authors"]]
			}
		) |> unlist()


get_authors <- function(d) {
	p <- lapply(1:length(d), \(i) {
				n <- d[[i]][["authors"]]
				n <- unlist(strsplit(n, ";"))
				data.frame(id=i, p=trimws(n))
			}
		)
	p <- do.call(rbind, p)
	p$p <- gsub(",", ", ", p$p)
	p$p <- gsub(",  ", ", ", p$p)
	p$p[grep("applicable", p$p, TRUE)] <- ""
	p$p <- gsub("Andrew J. McDonald", "McDonald, Andrew", p$p) 
	p$p <- gsub("Sherpa R. Sonam", "Sherpa, Sonam", p$p) 
	p$p <- gsub("Abubakar H.Inuwa", "Abubakar H. Inuwa", p$p) 
	p$p <- gsub("Wortmann, Charles$", "Wortmann, Charles S.", p$p) 
	p$p <- gsub("Wiredu Alexanda Nimo", "Wiredu, Alexanda Nimo", p$p) 
	p$p <- gsub("Bolo, Peter$", "Bolo, Peter Omondi", p$p) 
	p$p <- gsub("Balemi, T", "Balemi, Tesfaye", p$p)
	  

	nms1 <- c("Sherpa Sonam", "Poonia Shishpal", "Kumar Sunil", "Sharma Sachin", "Ajay Anurag", "Wu William", "Singh Balwinder", "McDonald Andrew", "Hood-Nowotny Rebbeca", "Majaliwa Jackson", "Tumuhairwe John-Baptist", "Quispe Katherine", "Okoth John",  "Kyei-Boahen Stephen")
	nms2 <- gsub(" ", ", ", nms1)
	for (i in 1:length(nms1)) p$p <- gsub(nms1[i], nms2[i], p$p)

	i <- grepl(",|ICRAF|ABC|ICRISAT|SARI|IITA|ISRIC|CIMMYT|TLC|University|IWIN|ARI|Program|ILRI|Davis", p$p)
  n <- strsplit(p$p[!i], " \\s*(?=[^ ]+$)", perl=TRUE)
  p$p[!i] <- sapply(n, \(i) paste0(rev(i), collapse=", "))
	p$p <- gsub("-, ", "", p$p) # "-, RHoMIS"
	p$p <- gsub("Anurag, Ajay", "Ajay, Anurag", p$p)
	p$p <- gsub("Sila, Andrew Musili", "Sila, Andrew", p$p) 
	p$p <- gsub("Sileshi, Gudeta W$", "Sileshi, Gudeta W.", p$p) 
	p$p <- gsub("Talabi, O.A.", "Talabi, A.O.", p$p) 
	p$p <- gsub("Tor Gunnar", "Tor-Gunnar", p$p) 
	p$p <- gsub("Winowiecki, Leigh$", "Winowiecki, Leigh Ann", p$p) 
	
	tab <- as.data.frame(table(p$p))
	colnames(tab) <- c("name", "datasets")
  tab[tab$name != "", ]
}


cartab <- get_tab(d, "carob_contributor")
autab <- get_authors(d)

intab <- get_tab(d, "data_institute")

```

### Script authors

```{r catable, echo=FALSE}
out = paste0(paste0(cartab[,1], " (", cartab[,2], ")"), collapse="; ")
#kableExtra::kbl(cartab) |> kable_classic(full_width = FALSE) |>
#   kable_styling(bootstrap_options = c("striped", "hover"))
```
`r out`

### Dataset institutes

```{r instable, echo=FALSE}
out = paste0(paste0(intab[,1], " (", intab[,2], ")"), collapse="; ")
#kableExtra::kbl(intab) |> kable_classic(full_width = FALSE) |>
#   kable_styling(bootstrap_options = c("striped", "hover"))
```
`r out`

### Dataset authors

```{r autable, echo=FALSE}
out <- paste0(paste0(autab[,1], " (", autab[,2], ")"), collapse="; ")
#DT::datatable(autab, escape=FALSE, rownames=FALSE)
```
`r out`


<br>
